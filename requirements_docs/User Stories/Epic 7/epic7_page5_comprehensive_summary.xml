<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" modified="2025-11-03T14:15:00.000Z" agent="draw.io" version="24.0.0">
  <diagram name="Epic 7 - Page 5: COMPREHENSIVE SUMMARY" id="epic7_page5">
    <mxGraphModel dx="3200" dy="2000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="5200" pageHeight="3600" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        
        <!-- ============================================= -->
        <!-- TITLE -->
        <!-- ============================================= -->
        
        <mxCell id="title" value="EPIC 7: VERSION CONTROL &amp; CONTENT MANAGEMENT - COMPREHENSIVE SUMMARY&#xa;&#xa;This page synthesizes all 4 user stories into a cohesive version management system, showing integration points with Epic 6 (Sub-Chapter Management),&#xa;architectural patterns, database operations, and real-time update flows.&#xa;&#xa;User Stories Covered:&#xa;1. Create Content Versions (automatic, non-destructive)&#xa;2. Restore Previous Versions (user-initiated rollback)&#xa;3. Add Version Descriptions (document reasoning)&#xa;4. Track Version Metadata (comprehensive monitoring)" style="text;html=1;strokeColor=#1976D2;fillColor=#E3F2FD;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=16;fontStyle=1;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="5120" height="200" as="geometry"/>
        </mxCell>
        
        <!-- ============================================= -->
        <!-- SECTION 1: USER STORY OVERVIEW -->
        <!-- ============================================= -->
        
        <mxCell id="section1_title" value="SECTION 1: USER STORIES OVERVIEW" style="text;html=1;strokeColor=#1976D2;fillColor=#BBDEFB;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="40" y="280" width="1240" height="60" as="geometry"/>
        </mxCell>
        
        <!-- User Story 1 -->
        <mxCell id="story1" value="ðŸ“ USER STORY 1: Create Content Versions&#xa;&#xa;Trigger: Sub-chapter creation or regeneration (Epic 6)&#xa;&#xa;Process:&#xa;1. User creates/regenerates sub-chapter&#xa;2. Content generated via RAG (Epic 5A/5B)&#xa;3. Version automatically saved to sub_chapter_versions&#xa;4. Version number auto-incremented&#xa;5. snapshot_metadata captures context:&#xa;   â€¢ character_id&#xa;   â€¢ applied_world_rule_ids&#xa;   â€¢ generation_params&#xa;6. sub_chapters.current_version_id updated&#xa;7. Real-time broadcast: 'version_created'&#xa;&#xa;Key Features:&#xa;â€¢ Automatic (no user action needed)&#xa;â€¢ Non-destructive (all versions preserved)&#xa;â€¢ Complete context snapshot&#xa;â€¢ Immediate feedback via Realtime&#xa;&#xa;Result:&#xa;âœ… Every content change has full audit trail&#xa;âœ… Complete revision history maintained&#xa;âœ… Context preserved for reproducibility" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#2E7D32;fontSize=11;fontFamily=Arial;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="360" width="600" height="460" as="geometry"/>
        </mxCell>
        
        <!-- User Story 2 -->
        <mxCell id="story2" value="ðŸ”„ USER STORY 2: Restore Previous Versions&#xa;&#xa;Trigger: User explicitly chooses to revert&#xa;&#xa;Process:&#xa;1. User views version history modal&#xa;2. User selects specific version&#xa;3. System shows restore confirmation modal:&#xa;   â€¢ Warning: 'Current content will be replaced'&#xa;   â€¢ Version details shown&#xa;   â€¢ 'Restore' or 'Cancel'&#xa;4. User confirms restore&#xa;5. FastAPI updates sub_chapters table:&#xa;   â€¢ content = selected_version.content&#xa;   â€¢ current_version_id = selected_version.id&#xa;   â€¢ word_count = selected_version.word_count&#xa;6. Database trigger updates chapter word count&#xa;7. Real-time broadcast: 'content_restored'&#xa;8. Success message: 'Restored to version X'&#xa;&#xa;Key Features:&#xa;â€¢ User-initiated (explicit action)&#xa;â€¢ Synchronous (instant restore)&#xa;â€¢ Confirmation modal (prevent accidents)&#xa;â€¢ All versions still preserved&#xa;â€¢ Does NOT create new version&#xa;&#xa;Result:&#xa;âœ… Users can undo unwanted changes&#xa;âœ… Experimentation without fear&#xa;âœ… Safety net for content management" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#F9A825;fontSize=11;fontFamily=Arial;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="680" y="360" width="600" height="460" as="geometry"/>
        </mxCell>
        
        <!-- User Story 3 -->
        <mxCell id="story3" value="âœï¸ USER STORY 3: Add Version Descriptions&#xa;&#xa;Trigger: User wants to document changes&#xa;&#xa;Process:&#xa;1. User opens version history modal&#xa;2. User clicks 'Edit Description' icon&#xa;3. Inline text area appears (max 1000 chars)&#xa;4. User types description&#xa;5. Frontend validates length&#xa;6. User clicks 'Save'&#xa;7. API: PUT /versions/{id}/description&#xa;8. Backend validates authorization&#xa;9. Database: UPDATE change_description&#xa;10. Real-time broadcast: 'description_updated'&#xa;11. UI updates inline (no modal)&#xa;12. Toast: 'Description saved'&#xa;&#xa;Key Features:&#xa;â€¢ Optional field (can be blank)&#xa;â€¢ Inline editing (fast UX)&#xa;â€¢ Real-time sync across clients&#xa;â€¢ Independent of version creation&#xa;â€¢ Can edit any version's description&#xa;&#xa;Result:&#xa;âœ… Clear documentation of changes&#xa;âœ… Team collaboration support&#xa;âœ… Audit trail readability" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontSize=11;fontFamily=Arial;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="860" width="600" height="420" as="geometry"/>
        </mxCell>
        
        <!-- User Story 4 -->
        <mxCell id="story4" value="ðŸ“Š USER STORY 4: Track Version Metadata&#xa;&#xa;Trigger: User needs to analyze version history&#xa;&#xa;Process:&#xa;1. User opens version history modal&#xa;2. API: GET /versions?filters&amp;sort&#xa;3. Backend queries database with filters&#xa;4. Returns enriched metadata:&#xa;   â€¢ Basic: version #, dates, word count&#xa;   â€¢ Generation: AI/manual, model, job ID&#xa;   â€¢ Context: character, world rules&#xa;   â€¢ User: description, creator&#xa;5. Frontend displays sortable table&#xa;6. User applies filters:&#xa;   â€¢ AI-generated only&#xa;   â€¢ Date ranges&#xa;   â€¢ Word count ranges&#xa;7. User sorts by column&#xa;8. User clicks 'View Details'&#xa;9. Detailed modal shows full metadata:&#xa;   â€¢ Parsed snapshot_metadata&#xa;   â€¢ Character name&#xa;   â€¢ World rules list&#xa;   â€¢ Generation parameters&#xa;&#xa;Key Features:&#xa;â€¢ Comprehensive metadata tracking&#xa;â€¢ Flexible sorting &amp; filtering&#xa;â€¢ Detailed drill-down capability&#xa;â€¢ Real-time updates for new versions&#xa;â€¢ Export-ready (future)&#xa;&#xa;Result:&#xa;âœ… Full visibility into content evolution&#xa;âœ… Data-driven content decisions&#xa;âœ… Quality assurance support" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontSize=11;fontFamily=Arial;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="680" y="860" width="600" height="520" as="geometry"/>
        </mxCell>
        
        <!-- ============================================= -->
        <!-- SECTION 2: INTEGRATION MAP -->
        <!-- ============================================= -->
        
        <mxCell id="section2_title" value="SECTION 2: EPIC INTEGRATION MAP" style="text;html=1;strokeColor=#1976D2;fillColor=#BBDEFB;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="1320" y="280" width="1240" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Integration diagram -->
        <mxCell id="integration_diagram" value="ðŸ”— EPIC 6 â†’ EPIC 7 INTEGRATION FLOW&#xa;&#xa;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”&#xa;â”‚                         EPIC 6                                  â”‚&#xa;â”‚              Sub-Chapter Management System                      â”‚&#xa;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&#xa;â”‚                                                                 â”‚&#xa;â”‚  USER STORY 1: Create Sub-Chapter Segments                     â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" User creates sub-chapter                                  â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Content generated via RAG                                â”‚&#xa;â”‚  Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Version 1 created â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€Ã¢"ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚&#xa;â”‚                                             Ã¢"â€š         â”‚&#xa;â”‚  USER STORY 5: Regenerate Sub-Chapter Content Ã¢"â€š         â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" User triggers regeneration           Ã¢"â€š         â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" New content generated                 Ã¢"â€š         â”‚&#xa;â”‚  Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Version N+1 created â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚&#xa;â”‚                                             Ã¢"â€š         â”‚&#xa;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&#xa;                                              Ã¢"â€š&#xa;                                              Ã¢"â€š Version Created&#xa;                                              Ã¢"â€š (INSERT event)&#xa;                                              Ã¢"â€š&#xa;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€Ã¢"â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”&#xa;â”‚                         EPIC 7                          â”‚&#xa;â”‚           Version Control &amp; Management                 â”‚&#xa;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&#xa;â”‚                                                         â”‚&#xa;â”‚  STORY 1: Create Content Versions (AUTOMATIC)          â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Receive version from Epic 6                         â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Save to sub_chapter_versions                        â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Capture snapshot_metadata                           â”‚&#xa;â”‚  Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Broadcast real-time update                          â”‚&#xa;â”‚          Ã¢"â€š                                                â”‚&#xa;â”‚          Ã¢"â€š                                                â”‚&#xa;â”‚          Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Enables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚&#xa;â”‚                                              Ã¢"â€š         â”‚&#xa;â”‚  STORY 4: Track Version Metadata (VIEW)     Ã¢"â€š         â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Display all versions             Ã¢â€ ï¿½â”€â”€â”€â”€â”€â”€â”˜         â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Sort &amp; filter                                      â”‚&#xa;â”‚  Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" View detailed metadata                              â”‚&#xa;â”‚          Ã¢"â€š                                                â”‚&#xa;â”‚          Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Enables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚&#xa;â”‚                                              Ã¢"â€š         â”‚&#xa;â”‚  STORY 2: Restore Previous Versions (ACTION) Ã¢"â€š         â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" User selects version to restore  Ã¢â€ ï¿½â”€â”€â”€â”€â”€â”€â”˜         â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Update current_version_id                           â”‚&#xa;â”‚  Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Broadcast content change                            â”‚&#xa;â”‚          Ã¢"â€š                                                â”‚&#xa;â”‚          Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Enables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚&#xa;â”‚                                              Ã¢"â€š         â”‚&#xa;â”‚  STORY 3: Add Version Descriptions (DOCUMENT)Ã¢"â€š         â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" User adds description            Ã¢â€ ï¿½â”€â”€â”€â”€â”€â”€â”˜         â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Update change_description                           â”‚&#xa;â”‚  Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Broadcast description change                        â”‚&#xa;â”‚                                                         â”‚&#xa;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&#xa;&#xa;KEY INTEGRATION POINTS:&#xa;â€¢ Epic 6 creates versions â†’ Epic 7 manages them&#xa;â€¢ All 4 Epic 7 stories work together seamlessly&#xa;â€¢ Real-time updates connect everything&#xa;â€¢ Database triggers provide automation&#xa;â€¢ Supabase RLS ensures security" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1976D2;fontSize=9;fontFamily=Courier New;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1320" y="360" width="1240" height="900" as="geometry"/>
        </mxCell>
        
        <!-- ============================================= -->
        <!-- SECTION 3: DATABASE SCHEMA -->
        <!-- ============================================= -->
        
        <mxCell id="section3_title" value="SECTION 3: DATABASE SCHEMA &amp; OPERATIONS" style="text;html=1;strokeColor=#1976D2;fillColor=#BBDEFB;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="2600" y="280" width="1240" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Schema diagram -->
        <mxCell id="schema" value="ðŸ“¦ sub_chapter_versions TABLE SCHEMA&#xa;&#xa;CREATE TABLE sub_chapter_versions (&#xa;  -- Primary Key&#xa;  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),&#xa;  &#xa;  -- Foreign Keys&#xa;  sub_chapter_id UUID NOT NULL &#xa;    REFERENCES sub_chapters(id) ON DELETE CASCADE,&#xa;  generation_job_id UUID &#xa;    REFERENCES generation_jobs(id),&#xa;  created_by_user_id UUID &#xa;    REFERENCES auth.users(id),&#xa;  &#xa;  -- Version Identity&#xa;  version_number INT NOT NULL,&#xa;  &#xa;  -- Content&#xa;  content TEXT NOT NULL,&#xa;  word_count INT NOT NULL,&#xa;  &#xa;  -- Generation Metadata&#xa;  is_ai_generated BOOLEAN DEFAULT FALSE,&#xa;  generated_by_model VARCHAR,&#xa;  snapshot_metadata JSONB,&#xa;  &#xa;  -- User Documentation&#xa;  change_description TEXT,&#xa;  &#xa;  -- Timestamps&#xa;  created_at TIMESTAMP DEFAULT NOW(),&#xa;  updated_at TIMESTAMP DEFAULT NOW(),&#xa;  &#xa;  -- Constraints&#xa;  UNIQUE(sub_chapter_id, version_number)&#xa;);&#xa;&#xa;-- Indexes for Performance&#xa;CREATE INDEX idx_sub_chapter_versions_sub_chapter_id &#xa;  ON sub_chapter_versions(sub_chapter_id);&#xa;  &#xa;CREATE INDEX idx_sub_chapter_versions_lookup &#xa;  ON sub_chapter_versions(sub_chapter_id, version_number DESC);&#xa;  &#xa;CREATE INDEX idx_sub_chapter_versions_created_at&#xa;  ON sub_chapter_versions(created_at DESC);&#xa;  &#xa;-- RLS Policy&#xa;CREATE POLICY &quot;Users can access own sub-chapter versions&quot;&#xa;  ON sub_chapter_versions FOR ALL&#xa;  USING (&#xa;    EXISTS (&#xa;      SELECT 1 FROM sub_chapters sc&#xa;      JOIN chapters c ON sc.chapter_id = c.id&#xa;      JOIN books b ON c.book_id = b.id&#xa;      JOIN trilogy_projects tp ON b.trilogy_id = tp.id&#xa;      WHERE sc.id = sub_chapter_versions.sub_chapter_id&#xa;      AND tp.user_id = auth.uid()&#xa;    )&#xa;  );" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#6A1B9A;fontSize=9;fontFamily=Courier New;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="2600" y="360" width="800" height="700" as="geometry"/>
        </mxCell>
        
        <!-- Operations diagram -->
        <mxCell id="operations" value="ðŸ”§ KEY DATABASE OPERATIONS&#xa;&#xa;1ï¸âƒ£ CREATE VERSION (Epic 6 â†’ Epic 7)&#xa;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&#xa;INSERT INTO sub_chapter_versions (&#xa;  sub_chapter_id,&#xa;  version_number,&#xa;  content,&#xa;  word_count,&#xa;  is_ai_generated,&#xa;  generated_by_model,&#xa;  generation_job_id,&#xa;  snapshot_metadata,&#xa;  created_by_user_id&#xa;) VALUES (&#xa;  $1, -- sub_chapter_id&#xa;  (SELECT COALESCE(MAX(version_number), 0) + 1 &#xa;   FROM sub_chapter_versions &#xa;   WHERE sub_chapter_id = $1), -- Auto-increment&#xa;  $2, -- content&#xa;  $3, -- word_count&#xa;  $4, -- is_ai_generated&#xa;  $5, -- generated_by_model&#xa;  $6, -- generation_job_id&#xa;  $7, -- snapshot_metadata (JSONB)&#xa;  $8  -- created_by_user_id&#xa;)&#xa;RETURNING *;&#xa;&#xa;&#xa;2ï¸âƒ£ RESTORE VERSION (Story 2)&#xa;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&#xa;-- Step 1: Get version content&#xa;SELECT content, word_count, id&#xa;FROM sub_chapter_versions&#xa;WHERE id = $1; -- version_id&#xa;&#xa;-- Step 2: Update sub_chapters (restore)&#xa;UPDATE sub_chapters&#xa;SET &#xa;  content = $1,           -- from version&#xa;  word_count = $2,        -- from version&#xa;  current_version_id = $3,-- version id&#xa;  updated_at = NOW()&#xa;WHERE id = $4             -- sub_chapter_id&#xa;RETURNING *;&#xa;&#xa;-- Step 3: Trigger updates chapter word count&#xa;&#xa;&#xa;3ï¸âƒ£ UPDATE DESCRIPTION (Story 3)&#xa;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&#xa;UPDATE sub_chapter_versions&#xa;SET &#xa;  change_description = $1,&#xa;  updated_at = NOW()&#xa;WHERE id = $2&#xa;RETURNING *;&#xa;&#xa;&#xa;4ï¸âƒ£ LIST VERSIONS WITH FILTERS (Story 4)&#xa;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&#xa;SELECT &#xa;  scv.*,&#xa;  sc.current_version_id,&#xa;  c.name as character_name,&#xa;  u.email as created_by_email&#xa;FROM sub_chapter_versions scv&#xa;JOIN sub_chapters sc ON scv.sub_chapter_id = sc.id&#xa;LEFT JOIN characters c &#xa;  ON (scv.snapshot_metadata->>'character_id')::uuid = c.id&#xa;LEFT JOIN auth.users u &#xa;  ON scv.created_by_user_id = u.id&#xa;WHERE scv.sub_chapter_id = $1&#xa;  AND ($2::boolean IS NULL OR scv.is_ai_generated = $2)&#xa;  AND ($3::timestamp IS NULL OR scv.created_at >= $3)&#xa;  AND ($4::timestamp IS NULL OR scv.created_at <= $4)&#xa;ORDER BY created_at DESC;&#xa;&#xa;&#xa;5ï¸âƒ£ GET VERSION DETAILS (Story 4)&#xa;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&#xa;-- Get full version with world rules&#xa;SELECT &#xa;  scv.*,&#xa;  sc.current_version_id = scv.id as is_current,&#xa;  c.name as character_name,&#xa;  &#xa;  -- Extract world rule IDs from JSONB&#xa;  (SELECT array_agg(wr.title)&#xa;   FROM world_rules wr&#xa;   WHERE wr.id = ANY(&#xa;     SELECT jsonb_array_elements_text(&#xa;       scv.snapshot_metadata->'applied_world_rule_ids'&#xa;     )::uuid&#xa;   )) as world_rule_titles&#xa;   &#xa;FROM sub_chapter_versions scv&#xa;JOIN sub_chapters sc ON scv.sub_chapter_id = sc.id&#xa;LEFT JOIN characters c &#xa;  ON (scv.snapshot_metadata->>'character_id')::uuid = c.id&#xa;WHERE scv.id = $1;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#E65100;fontSize=8;fontFamily=Courier New;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="3440" y="360" width="700" height="1020" as="geometry"/>
        </mxCell>
        
        <!-- ============================================= -->
        <!-- SECTION 4: REAL-TIME ARCHITECTURE -->
        <!-- ============================================= -->
        
        <mxCell id="section4_title" value="SECTION 4: REAL-TIME UPDATE ARCHITECTURE" style="text;html=1;strokeColor=#1976D2;fillColor=#BBDEFB;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="40" y="1420" width="2520" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Realtime flow -->
        <mxCell id="realtime_flow" value="âš¡ SUPABASE REALTIME EVENT FLOW&#xa;&#xa;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”&#xa;â”‚                              DATABASE LAYER                                          â”‚&#xa;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&#xa;â”‚                                                                                      â”‚&#xa;â”‚  Event 1: INSERT on sub_chapter_versions (Story 1)                                  â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Triggered by Epic 6 content generation                                         â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" New version row created                                                          â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Realtime trigger fires                                                           â”‚&#xa;â”‚  Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Payload: { eventType: 'INSERT', new: {version record} }                         â”‚&#xa;â”‚         Ã¢"â€š                                                                             â”‚&#xa;â”‚         Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"Â¼Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"        â”‚&#xa;â”‚                        Ã¢"â€š                                                             â”‚&#xa;â”‚  Event 2: UPDATE on sub_chapters (Story 2)                                          â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Triggered by version restore                                                    â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" current_version_id changed                                                       â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" content &amp; word_count changed                                                    â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Realtime trigger fires                                                           â”‚&#xa;â”‚  Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Payload: { eventType: 'UPDATE', old: {...}, new: {...} }                       â”‚&#xa;â”‚         Ã¢"â€š                                                                             â”‚&#xa;â”‚         Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"Â¼Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"        â”‚&#xa;â”‚                        Ã¢"â€š                                                             â”‚&#xa;â”‚  Event 3: UPDATE on sub_chapter_versions (Story 3)                                  â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Triggered by description edit                                                   â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" change_description field changed                                                 â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬ Realtime trigger fires                                                           â”‚&#xa;â”‚  Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Payload: { eventType: 'UPDATE', old: {...}, new: {...} }                       â”‚&#xa;â”‚         Ã¢"â€š                                                                             â”‚&#xa;â”‚         Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"Â¼Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"        â”‚&#xa;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&#xa;                           Ã¢"â€š&#xa;                           Ã¢"â€š WebSocket Connection&#xa;                           Ã¢"â€š&#xa;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€Ã¢"Â´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”&#xa;â”‚                      SUPABASE REALTIME LAYER                                        â”‚&#xa;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&#xa;â”‚                                                                                      â”‚&#xa;â”‚  Channel: sub_chapter_versions:sub_chapter_id={id}                                  â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Multiple clients can subscribe                                                    â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Broadcasts to all subscribers                                                     â”‚&#xa;â”‚  Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Latency: typically < 100ms                                                        â”‚&#xa;â”‚                                                                                      â”‚&#xa;â”‚  Event Types:                                                                        â”‚&#xa;â”‚  â€¢ INSERT: New version created                                                       â”‚&#xa;â”‚  â€¢ UPDATE: Version description edited OR content restored                           â”‚&#xa;â”‚                                                                                      â”‚&#xa;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&#xa;                           Ã¢"â€š&#xa;                           Ã¢"â€š Broadcast to Clients&#xa;                           Ã¢"â€š&#xa;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€Ã¢"Â´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”&#xa;â”‚                         FRONTEND LAYER (Streamlit)                                  â”‚&#xa;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&#xa;â”‚                                                                                      â”‚&#xa;â”‚  Subscription Code:                                                                  â”‚&#xa;â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                   â”‚&#xa;â”‚  const channel = supabase                                                            â”‚&#xa;â”‚    .channel('sub_chapter_versions')                                                  â”‚&#xa;â”‚    .on('postgres_changes', {                                                         â”‚&#xa;â”‚      event: '*',                                                                     â”‚&#xa;â”‚      schema: 'public',                                                               â”‚&#xa;â”‚      table: 'sub_chapter_versions',                                                  â”‚&#xa;â”‚      filter: `sub_chapter_id=eq.${subChapterId}`                                     â”‚&#xa;â”‚    }, handleRealtimeEvent)                                                           â”‚&#xa;â”‚    .subscribe();                                                                     â”‚&#xa;â”‚                                                                                      â”‚&#xa;â”‚  Event Handlers:                                                                     â”‚&#xa;â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                     â”‚&#xa;â”‚                                                                                      â”‚&#xa;â”‚  function handleRealtimeEvent(payload) {                                             â”‚&#xa;â”‚    if (payload.eventType === 'INSERT') {                                             â”‚&#xa;â”‚      // Story 1: New version created                                                 â”‚&#xa;â”‚      if (versionHistoryModalOpen) {                                                  â”‚&#xa;â”‚        versions.unshift(payload.new);                                                â”‚&#xa;â”‚        animateRow(payload.new.id, 'insert'); // Green flash                         â”‚&#xa;â”‚        toast.success('New version created (v' +                                      â”‚&#xa;â”‚                      payload.new.version_number + ')');                              â”‚&#xa;â”‚      }                                                                                â”‚&#xa;â”‚    }                                                                                 â”‚&#xa;â”‚                                                                                      â”‚&#xa;â”‚    if (payload.eventType === 'UPDATE') {                                             â”‚&#xa;â”‚      // Story 3: Description updated                                                 â”‚&#xa;â”‚      const index = versions.findIndex(v => v.id === payload.new.id);                 â”‚&#xa;â”‚      if (index !== -1) {                                                              â”‚&#xa;â”‚        versions[index] = payload.new;                                                â”‚&#xa;â”‚        animateRow(payload.new.id, 'update'); // Yellow flash                        â”‚&#xa;â”‚        toast.info('Version description updated');                                    â”‚&#xa;â”‚      }                                                                                â”‚&#xa;â”‚    }                                                                                 â”‚&#xa;â”‚  }                                                                                   â”‚&#xa;â”‚                                                                                      â”‚&#xa;â”‚  UI Updates:                                                                         â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Version list refreshes automatically                                               â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" Animations provide visual feedback                                                â”‚&#xa;â”‚  Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬ Toast notifications inform user                                                  â”‚&#xa;â”‚  Ã¢""Ã¢"â‚¬Ã¢"â‚¬Ã¢"â‚¬Ã¢" No manual refresh needed                                                         â”‚&#xa;â”‚                                                                                      â”‚&#xa;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&#xa;&#xa;KEY BENEFITS:&#xa;âœ… Instant synchronization across all clients&#xa;âœ… No polling needed (efficient)&#xa;âœ… Automatic UI updates&#xa;âœ… Collaborative workflows enabled" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E0F2F1;strokeColor=#00695C;fontSize=8;fontFamily=Courier New;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="1500" width="2520" height="1020" as="geometry"/>
        </mxCell>
        
        <!-- ============================================= -->
        <!-- SECTION 5: ARCHITECTURAL PATTERNS -->
        <!-- ============================================= -->
        
        <mxCell id="section5_title" value="SECTION 5: ARCHITECTURAL PATTERNS &amp; BEST PRACTICES" style="text;html=1;strokeColor=#1976D2;fillColor=#BBDEFB;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="2600" y="1420" width="2560" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Pattern 1 -->
        <mxCell id="pattern1" value="âœ… PATTERN 1: Non-Destructive Versioning&#xa;&#xa;Principle:&#xa;Never delete or overwrite versions. All content changes create new version records.&#xa;&#xa;Implementation:&#xa;â€¢ INSERT only, never UPDATE on content field&#xa;â€¢ Restore = change pointer, not content&#xa;â€¢ current_version_id points to active version&#xa;â€¢ All versions preserved in perpetuity&#xa;&#xa;Benefits:&#xa;â€¢ Complete audit trail&#xa;â€¢ Safe experimentation&#xa;â€¢ Rollback capability&#xa;â€¢ Compliance support&#xa;&#xa;Trade-offs:&#xa;â€¢ Storage grows linearly with versions&#xa;â€¢ But: Text compression is excellent&#xa;â€¢ Mitigation: Archive old versions to cold storage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#2E7D32;fontSize=10;fontFamily=Arial;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="2600" y="1500" width="600" height="380" as="geometry"/>
        </mxCell>
        
        <!-- Pattern 2 -->
        <mxCell id="pattern2" value="âœ… PATTERN 2: Context Snapshotting&#xa;&#xa;Principle:&#xa;Capture complete generation context in snapshot_metadata JSONB field.&#xa;&#xa;Implementation:&#xa;â€¢ Store character_id (not full character object)&#xa;â€¢ Store applied_world_rule_ids[] (not full rules)&#xa;â€¢ Store generation_params&#xa;â€¢ Lookup details on demand via joins&#xa;&#xa;Benefits:&#xa;â€¢ Reproducible generation&#xa;â€¢ Historical analysis capability&#xa;â€¢ Debugging support&#xa;â€¢ Audit compliance&#xa;&#xa;Data Captured:&#xa;{&#xa;  'character_id': 'uuid',&#xa;  'character_name': 'Sarah Chen',&#xa;  'applied_world_rule_ids': ['uuid1', 'uuid2'],&#xa;  'generation_params': {&#xa;    'temperature': 0.7,&#xa;    'max_tokens': 2500&#xa;  },&#xa;  'prompt_length': 1542&#xa;}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#F9A825;fontSize=10;fontFamily=Arial;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="3240" y="1500" width="600" height="460" as="geometry"/>
        </mxCell>
        
        <!-- Pattern 3 -->
        <mxCell id="pattern3" value="âœ… PATTERN 3: Automatic vs. Manual Operations&#xa;&#xa;Principle:&#xa;Distinguish between automatic system operations and explicit user actions.&#xa;&#xa;Implementation:&#xa;â€¢ Story 1: Automatic (triggered by Epic 6)&#xa;â€¢ Stories 2-4: Manual (user-initiated)&#xa;â€¢ is_ai_generated flag distinguishes source&#xa;â€¢ created_by_user_id tracks actor&#xa;&#xa;Benefits:&#xa;â€¢ Clear attribution&#xa;â€¢ User confidence (know what's automatic)&#xa;â€¢ Analytics capability&#xa;â€¢ Workflow optimization&#xa;&#xa;UI Representation:&#xa;â€¢ AI versions: ðŸ¤– badge&#xa;â€¢ Manual edits: âœï¸ badge&#xa;â€¢ Filter by type enabled" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontSize=10;fontFamily=Arial;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="3880" y="1500" width="600" height="380" as="geometry"/>
        </mxCell>
        
        <!-- Pattern 4 -->
        <mxCell id="pattern4" value="âœ… PATTERN 4: Synchronous Restore, Async Create&#xa;&#xa;Principle:&#xa;Match operation speed to user expectations.&#xa;&#xa;Implementation:&#xa;â€¢ Version creation: Async (2-3 min, Epic 6)&#xa;  - Content generation takes time&#xa;  - User can continue working&#xa;  - WebSocket provides progress&#xa;  &#xa;â€¢ Version restore: Synchronous (<100ms)&#xa;  - Just a pointer update&#xa;  - User expects immediate result&#xa;  - No generation needed&#xa;  &#xa;â€¢ Description update: Synchronous (<50ms)&#xa;  - Simple field update&#xa;  - Inline editing UX&#xa;  - Real-time broadcast&#xa;&#xa;Benefits:&#xa;â€¢ Responsive UX&#xa;â€¢ Clear feedback&#xa;â€¢ No unnecessary waiting&#xa;â€¢ Optimal resource use" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontSize=10;fontFamily=Arial;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="4520" y="1500" width="640" height="420" as="geometry"/>
        </mxCell>
        
        <!-- Pattern 5 -->
        <mxCell id="pattern5" value="âœ… PATTERN 5: Real-Time Collaboration Support&#xa;&#xa;Principle:&#xa;Enable multiple users to work simultaneously without conflicts.&#xa;&#xa;Implementation:&#xa;â€¢ Supabase Realtime broadcasts all changes&#xa;â€¢ All clients subscribed to same channel&#xa;â€¢ Optimistic UI updates on user actions&#xa;â€¢ Real-time updates from other users&#xa;â€¢ No locking needed (non-destructive)&#xa;&#xa;Scenarios:&#xa;â€¢ User A creates version â†’ User B sees it instantly&#xa;â€¢ User B restores version â†’ User A's view updates&#xa;â€¢ User A edits description â†’ User B sees change&#xa;â€¢ Multiple users viewing same history modal&#xa;&#xa;Benefits:&#xa;â€¢ True collaboration&#xa;â€¢ No stale data&#xa;â€¢ No conflicts&#xa;â€¢ Scalable to many users" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E0F2F1;strokeColor=#00695C;fontSize=10;fontFamily=Arial;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="2600" y="1920" width="600" height="400" as="geometry"/>
        </mxCell>
        
        <!-- Pattern 6 -->
        <mxCell id="pattern6" value="âœ… PATTERN 6: Metadata Enrichment&#xa;&#xa;Principle:&#xa;Compute and add helpful metadata at retrieval time, not storage time.&#xa;&#xa;Implementation:&#xa;Storage (minimal):&#xa;â€¢ version_number: 3&#xa;â€¢ created_at: '2025-11-03T14:00:00Z'&#xa;&#xa;Enrichment (on retrieval):&#xa;â€¢ version_label: 'v3'&#xa;â€¢ created_at_relative: '2 hours ago'&#xa;â€¢ is_current: true/false&#xa;â€¢ character_name: 'Sarah Chen'&#xa;â€¢ world_rule_titles: ['Mars Gravity', ...]&#xa;&#xa;Benefits:&#xa;â€¢ Smaller storage footprint&#xa;â€¢ Always current (names can change)&#xa;â€¢ Flexible presentation&#xa;â€¢ Easy to add new enrichments&#xa;&#xa;Trade-offs:&#xa;â€¢ Slightly slower queries&#xa;â€¢ But: Caching mitigates (Redis)&#xa;â€¢ Worth it for data accuracy" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#E65100;fontSize=10;fontFamily=Arial;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="3240" y="2000" width="600" height="460" as="geometry"/>
        </mxCell>
        
        <!-- Pattern 7 -->
        <mxCell id="pattern7" value="âœ… PATTERN 7: Inline Editing for Fast UX&#xa;&#xa;Principle:&#xa;Minimize modal usage for simple operations.&#xa;&#xa;Implementation:&#xa;â€¢ Version description editing: Inline in table&#xa;  - Click edit icon&#xa;  - Text area appears in place&#xa;  - Save/cancel buttons appear&#xa;  - No modal needed&#xa;  &#xa;â€¢ Version viewing: Modal only for details&#xa;  - Full metadata requires more space&#xa;  - Separate screen makes sense&#xa;  &#xa;Benefits:&#xa;â€¢ Faster workflow&#xa;â€¢ Less context switching&#xa;â€¢ More intuitive&#xa;â€¢ Professional feel&#xa;&#xa;Comparison:&#xa;âŒ Bad: Click edit â†’ Modal opens â†’ Edit â†’ Save â†’ Close&#xa;âœ… Good: Click edit â†’ Edit inline â†’ Save â†’ Done" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#6A1B9A;fontSize=10;fontFamily=Arial;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="3880" y="1920" width="600" height="440" as="geometry"/>
        </mxCell>
        
        <!-- Pattern 8 -->
        <mxCell id="pattern8" value="âœ… PATTERN 8: Defensive Programming&#xa;&#xa;Principle:&#xa;Validate and confirm destructive actions, fail gracefully.&#xa;&#xa;Implementation:&#xa;â€¢ Restore confirmation modal:&#xa;  - Warning message&#xa;  - Show what will change&#xa;  - Confirm/cancel buttons&#xa;  - Prevent accidental overwrites&#xa;  &#xa;â€¢ Description validation:&#xa;  - Max length check (1000 chars)&#xa;  - Frontend + backend validation&#xa;  - Clear error messages&#xa;  &#xa;â€¢ Authorization checks:&#xa;  - RLS on every query&#xa;  - 403 for unauthorized access&#xa;  - User must own trilogy&#xa;  &#xa;â€¢ Graceful error handling:&#xa;  - Toast notifications for errors&#xa;  - Detailed error messages&#xa;  - Retry suggestions&#xa;&#xa;Benefits:&#xa;â€¢ User confidence&#xa;â€¢ Fewer mistakes&#xa;â€¢ Better security&#xa;â€¢ Professional polish" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFECB3;strokeColor=#FF8F00;fontSize=10;fontFamily=Arial;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="4520" y="1960" width="640" height="500" as="geometry"/>
        </mxCell>
        
        <!-- ============================================= -->
        <!-- SECTION 6: USER JOURNEY -->
        <!-- ============================================= -->
        
        <mxCell id="section6_title" value="SECTION 6: COMPLETE USER JOURNEY" style="text;html=1;strokeColor=#1976D2;fillColor=#BBDEFB;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="40" y="2560" width="5120" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Journey -->
        <mxCell id="journey" value="Ã°Å¸Â§Â­ COMPLETE VERSION MANAGEMENT USER JOURNEY&#xa;&#xa;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”&#xa;â”‚                                                    DAY 1: INITIAL CREATION                                              â”‚&#xa;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  1. User creates sub-chapter with plot points                                                                          â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 6, Story 1                                                                                                   â”‚&#xa;â”‚     Ã¢""Ã¢"â‚¬Ã¢"â‚¬ Content generated via RAG (Epic 5A/5B)                                                                           â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  2. Version 1 automatically created                                                                                     â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 7, Story 1 (AUTOMATIC)                                                                                       â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Saved to sub_chapter_versions                                                                                    â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ snapshot_metadata captures character &amp; world rules                                                              â”‚&#xa;â”‚     Ã¢""Ã¢"â‚¬Ã¢"â‚¬ Real-time broadcast: 'v1 created'                                                                                 â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  3. User views result in version history                                                                                â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 7, Story 4                                                                                                   â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Sees: v1, 2,045 words, AI-generated ðŸ¤–                                                                          â”‚&#xa;â”‚     Ã¢""Ã¢"â‚¬Ã¢"â‚¬ Can add description to document rationale                                                                        â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  4. User adds description: &quot;Initial draft of opening scene&quot;                                                            â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 7, Story 3                                                                                                   â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Inline editing in version table                                                                                  â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Saved synchronously                                                                                              â”‚&#xa;â”‚     Ã¢""Ã¢"â‚¬Ã¢"â‚¬ Real-time broadcast to other clients                                                                             â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&#xa;&#xa;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”&#xa;â”‚                                              DAY 3: ITERATION &amp; REFINEMENT                                              â”‚&#xa;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  5. User wants to improve character voice                                                                               â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 6, Story 5 (Regenerate)                                                                                      â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ User clicks 'Regenerate Content'                                                                                  â”‚&#xa;â”‚     Ã¢""Ã¢"â‚¬Ã¢"â‚¬ New content generated (2-3 minutes)                                                                               â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  6. Version 2 automatically created                                                                                     â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 7, Story 1 (AUTOMATIC)                                                                                       â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Saved with new snapshot_metadata                                                                                 â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Real-time broadcast: 'v2 created'                                                                                 â”‚&#xa;â”‚     Ã¢""Ã¢"â‚¬Ã¢"â‚¬ Version history shows both v1 and v2                                                                              â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  7. User compares versions                                                                                              â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 7, Story 4                                                                                                   â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Views detailed metadata for both                                                                                 â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ v1: 2,045 words, Sarah POV                                                                                       â”‚&#xa;â”‚     Ã¢""Ã¢"â‚¬Ã¢"â‚¬ v2: 2,100 words, Sarah POV (improved)                                                                            â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  8. User decides v2 is worse, reverts to v1                                                                             â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 7, Story 2                                                                                                   â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Clicks 'Restore' on v1 row                                                                                        â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Confirmation modal: 'This will replace current content'                                                          â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ User confirms                                                                                                     â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Synchronous restore (<100ms)                                                                                     â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ current_version_id Ã¢â€ ' v1                                                                                          â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Real-time broadcast: 'content restored'                                                                          â”‚&#xa;â”‚     Ã¢""Ã¢"â‚¬Ã¢"â‚¬ v1 now marked as current (Ã¢Å“Â¨ star)                                                                                â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  9. User documents decision                                                                                             â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 7, Story 3                                                                                                   â”‚&#xa;â”‚     Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Edits v2 description: 'Regenerated but lost emotional depth. Reverted to v1.'                                    â”‚&#xa;â”‚     Ã¢""Ã¢"â‚¬Ã¢"â‚¬ Saved inline, real-time update                                                                                   â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&#xa;&#xa;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”&#xa;â”‚                                               DAY 5: PERSPECTIVE CHANGE                                                 â”‚&#xa;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  10. User decides to change chapter POV from Sarah to Marcus                                                            â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 6, Story 5 (Bulk regeneration)                                                                              â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ User changes character at chapter level                                                                          â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Database trigger updates all sub-chapters                                                                        â”‚&#xa;â”‚      Ã¢""Ã¢"â‚¬Ã¢"â‚¬ User clicks 'Regenerate with different POV'                                                                       â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  11. Version 3 automatically created with Marcus POV                                                                    â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 7, Story 1 (AUTOMATIC)                                                                                      â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ snapshot_metadata now shows Marcus character_id                                                                  â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Content generated with Marcus voice (Epic 5A)                                                                    â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Real-time broadcast: 'v3 created'                                                                                â”‚&#xa;â”‚      Ã¢""Ã¢"â‚¬Ã¢"â‚¬ Version history now shows v1, v2, v3                                                                             â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  12. User analyzes version progression                                                                                  â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 7, Story 4                                                                                                  â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Filters to show only AI-generated versions                                                                      â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Sorts by date (oldest to newest)                                                                                â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Views detailed metadata for each:                                                                               â”‚&#xa;â”‚      Ã¢"â€š   â€¢ v1: Sarah POV, 2,045 words                                                                                     â”‚&#xa;â”‚      Ã¢"â€š   â€¢ v2: Sarah POV, 2,100 words                                                                                     â”‚&#xa;â”‚      Ã¢"â€š   â€¢ v3: Marcus POV, 2,150 words                                                                                    â”‚&#xa;â”‚      Ã¢""Ã¢"â‚¬Ã¢"â‚¬ Can see complete context evolution                                                                              â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  13. User documents final version                                                                                       â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 7, Story 3                                                                                                  â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Adds description to v3: 'Changed to Marcus POV to align with chapter arc. More introspective tone.'            â”‚&#xa;â”‚      Ã¢""Ã¢"â‚¬Ã¢"â‚¬ Complete audit trail maintained                                                                                 â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&#xa;&#xa;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”&#xa;â”‚                                              MONTH 2: REVIEW &amp; ANALYSIS                                                 â”‚&#xa;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  14. User reviews writing process over time                                                                             â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 7, Story 4                                                                                                  â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Views version history for all sub-chapters                                                                      â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Filters by date range: Last 30 days                                                                            â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Sees patterns:                                                                                                  â”‚&#xa;â”‚      Ã¢"â€š   â€¢ Average 3-4 versions per sub-chapter                                                                          â”‚&#xa;â”‚      Ã¢"â€š   â€¢ Most regenerations: dialogue-heavy scenes                                                                     â”‚&#xa;â”‚      Ã¢"â€š   â€¢ Descriptions document iterative refinement                                                                    â”‚&#xa;â”‚      Ã¢""Ã¢"â‚¬Ã¢"â‚¬ Insights inform future writing strategy                                                                        â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  15. Collaborate with editor                                                                                            â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 11 (future): Share specific versions                                                                      â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Editor can see version history                                                                                  â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Editor adds comments via descriptions                                                                          â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Real-time collaboration enabled                                                                                â”‚&#xa;â”‚      Ã¢""Ã¢"â‚¬Ã¢"â‚¬ All changes tracked and attributed                                                                             â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â”‚  16. Export for publishing                                                                                              â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Epic 12 (future): Export final versions                                                                        â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Includes metadata for reference                                                                                â”‚&#xa;â”‚      Ã¢"Å“Ã¢"â‚¬Ã¢"â‚¬ Complete audit trail preserved                                                                                 â”‚&#xa;â”‚      Ã¢""Ã¢"â‚¬Ã¢"â‚¬ Professional manuscript ready                                                                                   â”‚&#xa;â”‚                                                                                                                         â”‚&#xa;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&#xa;&#xa;KEY TAKEAWAYS:&#xa;âœ… Version management is seamless and automatic&#xa;âœ… Users have complete control and transparency&#xa;âœ… All decisions are documented and reversible&#xa;âœ… Collaboration and analysis are enabled&#xa;âœ… Professional workflow supported end-to-end" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#6A1B9A;fontSize=8;fontFamily=Courier New;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="2640" width="5120" height="900" as="geometry"/>
        </mxCell>
        
        <!-- ============================================= -->
        <!-- FOOTER SUMMARY -->
        <!-- ============================================= -->
        
        <mxCell id="footer" value="EPIC 7 SUMMARY: Version Control &amp; Content Management provides a comprehensive, non-destructive version management system that automatically preserves all content changes, enables easy rollback, supports clear documentation, and offers complete visibility into content evolution. The system integrates seamlessly with Epic 6's content generation while providing real-time collaboration support through Supabase Realtime. All operations are designed to match user expectations: automatic where helpful, manual where control is needed, and always transparent with full metadata tracking." style="text;html=1;strokeColor=#1976D2;fillColor=#E3F2FD;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=12;fontStyle=1;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="40" y="3580" width="5120" height="80" as="geometry"/>
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
