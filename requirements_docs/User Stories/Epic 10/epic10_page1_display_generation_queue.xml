<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" modified="2025-11-03T00:00:00.000Z" agent="Claude" version="21.0.0" type="device">
  <diagram id="epic10-page1" name="Epic 10 - Story 1: Display Generation Queue">
    <mxGraphModel dx="2400" dy="1400" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1800" pageHeight="3200" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        
        <!-- TITLE -->
        <mxCell id="title" value="EPIC 10 - STORY 1: DISPLAY GENERATION QUEUE&#xa;Real-time dashboard showing all active and pending content generation jobs" style="text;html=1;strokeColor=#1976D2;fillColor=#E3F2FD;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="40" y="0" width="1760" height="50" as="geometry"/>
        </mxCell>
        
        <!-- SWIM LANES -->
        <mxCell id="lane-user" value="USER" style="swimlane;startSize=50;fontSize=14;fontStyle=1;fillColor=#E3F2FD;strokeColor=#1976D2;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="40" y="60" width="200" height="3000" as="geometry"/>
        </mxCell>
        
        <mxCell id="lane-react" value="REACT FRONTEND" style="swimlane;startSize=50;fontSize=14;fontStyle=1;fillColor=#F3E5F5;strokeColor=#7B1FA2;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="240" y="60" width="300" height="3000" as="geometry"/>
        </mxCell>
        
        <mxCell id="lane-fastapi" value="FASTAPI BACKEND" style="swimlane;startSize=50;fontSize=14;fontStyle=1;fillColor=#FFF3E0;strokeColor=#F57C00;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="540" y="60" width="300" height="3000" as="geometry"/>
        </mxCell>
        
        <mxCell id="lane-pgboss" value="JOB QUEUE (pg-boss)" style="swimlane;startSize=50;fontSize=14;fontStyle=1;fillColor=#E8F5E9;strokeColor=#388E3C;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="840" y="60" width="260" height="3000" as="geometry"/>
        </mxCell>
        
        <mxCell id="lane-websocket" value="WEBSOCKET MANAGER" style="swimlane;startSize=50;fontSize=14;fontStyle=1;fillColor=#FFF9C4;strokeColor=#F9A825;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="1100" y="60" width="260" height="3000" as="geometry"/>
        </mxCell>
        
        <mxCell id="lane-supabase" value="SUPABASE DATABASE" style="swimlane;startSize=50;fontSize=14;fontStyle=1;fillColor=#E0F2F1;strokeColor=#00796B;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="1360" y="60" width="240" height="3000" as="geometry"/>
        </mxCell>
        
        <mxCell id="lane-redis" value="REDIS CACHE" style="swimlane;startSize=50;fontSize=14;fontStyle=1;fillColor=#FFEBEE;strokeColor=#C62828;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="1600" y="60" width="200" height="3000" as="geometry"/>
        </mxCell>
        
        <!-- PHASE 1: INITIAL LOAD -->
        <mxCell id="phase1" value="PHASE 1: INITIAL DASHBOARD LOAD" style="text;html=1;strokeColor=#1976D2;fillColor=#BBDEFB;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=12;fontStyle=1;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="40" y="140" width="1760" height="30" as="geometry"/>
        </mxCell>
        
        <!-- User: Navigate to Dashboard -->
        <mxCell id="u1-navigate" value="Navigate to&#xa;Generation&#xa;Dashboard" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontFamily=Arial;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="60" y="200" width="160" height="60" as="geometry"/>
        </mxCell>
        
        <!-- React: Load Dashboard Component -->
        <mxCell id="r1-load" value="Load Dashboard Component&#xa;&#xa;• useEffect(() =&gt; {}, [])&#xa;• Initialize state:&#xa;  - jobs: []&#xa;  - loading: true&#xa;  - wsConnected: false&#xa;  - error: null" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontFamily=Arial;fontSize=10;align=left;" vertex="1" parent="1">
          <mxGeometry x="260" y="200" width="260" height="120" as="geometry"/>
        </mxCell>
        
        <!-- React: Fetch Jobs API Call -->
        <mxCell id="r1-api-call" value="API Request: Fetch Jobs&#xa;&#xa;GET /api/generation-jobs&#xa;  ?user_id={userId}&#xa;  &amp;status=queued,processing&#xa;  &amp;limit=50&#xa;&#xa;Headers:&#xa;  Authorization: Bearer {token}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontFamily=Courier New;fontSize=9;align=left;" vertex="1" parent="1">
          <mxGeometry x="260" y="360" width="260" height="140" as="geometry"/>
        </mxCell>
        
        <!-- FastAPI: Receive Request -->
        <mxCell id="f1-receive" value="Receive Request&#xa;&#xa;@app.get('/api/generation-jobs')&#xa;async def get_generation_jobs(&#xa;  user_id: str,&#xa;  status: List[JobStatus],&#xa;  limit: int = 50,&#xa;  current_user: User =&#xa;    Depends(get_current_user)&#xa;):" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontFamily=Courier New;fontSize=9;align=left;" vertex="1" parent="1">
          <mxGeometry x="560" y="360" width="260" height="160" as="geometry"/>
        </mxCell>
        
        <!-- FastAPI: Check Redis Cache -->
        <mxCell id="f1-check-cache" value="Check Redis Cache&#xa;&#xa;cache_key = &#xa;  f'jobs:{user_id}:active'&#xa;&#xa;cached_jobs = &#xa;  await redis.get(cache_key)&#xa;&#xa;if cached_jobs:&#xa;  return json.loads(cached_jobs)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontFamily=Courier New;fontSize=9;align=left;" vertex="1" parent="1">
          <mxGeometry x="560" y="560" width="260" height="140" as="geometry"/>
        </mxCell>
        
        <!-- Redis: Cache Lookup -->
        <mxCell id="redis1-lookup" value="GET&#xa;jobs:{user_id}:active&#xa;&#xa;Returns:&#xa;• JSON array of jobs&#xa;• NULL if not cached&#xa;  or expired&#xa;&#xa;TTL: 30 seconds" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#C62828;fontFamily=Courier New;fontSize=9;align=left;" vertex="1" parent="1">
          <mxGeometry x="1620" y="560" width="160" height="140" as="geometry"/>
        </mxCell>
        
        <!-- Decision: Cache Hit? -->
        <mxCell id="d1-cache-hit" value="Cache&#xa;Hit?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#F9A825;fontFamily=Arial;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="610" y="750" width="160" height="80" as="geometry"/>
        </mxCell>
        
        <!-- FastAPI: Query Database (Cache Miss) -->
        <mxCell id="f1-query-db" value="Query Supabase Database&#xa;&#xa;query = '''&#xa;SELECT &#xa;  gj.*,&#xa;  sc.title as sub_chapter_title,&#xa;  c.title as chapter_title,&#xa;  ch.name as character_name&#xa;FROM generation_jobs gj&#xa;JOIN sub_chapters sc &#xa;  ON gj.sub_chapter_id = sc.id&#xa;JOIN chapters c &#xa;  ON sc.chapter_id = c.id&#xa;JOIN characters ch &#xa;  ON sc.character_id = ch.id&#xa;WHERE gj.user_id = $1&#xa;  AND gj.status = ANY($2)&#xa;ORDER BY gj.created_at DESC&#xa;LIMIT $3&#xa;'''&#xa;&#xa;jobs = await db.fetch_all(&#xa;  query, user_id, status, limit&#xa;)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontFamily=Courier New;fontSize=8;align=left;" vertex="1" parent="1">
          <mxGeometry x="560" y="890" width="260" height="320" as="geometry"/>
        </mxCell>
        
        <!-- Supabase: Execute Query -->
        <mxCell id="s1-query" value="Execute Query&#xa;&#xa;generation_jobs table:&#xa;• id (UUID)&#xa;• user_id (UUID)&#xa;• trilogy_id (UUID)&#xa;• sub_chapter_id (UUID)&#xa;• status (ENUM)&#xa;  - queued&#xa;  - processing&#xa;  - completed&#xa;  - failed&#xa;  - cancelled&#xa;• stage (VARCHAR)&#xa;  - 'Retrieving context'&#xa;  - 'Building prompt'&#xa;  - 'Generating content'&#xa;  - 'Saving results'&#xa;• progress_percentage (INT 0-100)&#xa;• estimated_completion&#xa;  (TIMESTAMP)&#xa;• created_at (TIMESTAMP)&#xa;• updated_at (TIMESTAMP)&#xa;• error_message (TEXT)&#xa;• retry_count (INT)&#xa;&#xa;JOIN with:&#xa;• sub_chapters&#xa;• chapters&#xa;• characters" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#B2DFDB;strokeColor=#00796B;fontFamily=Courier New;fontSize=8;align=left;" vertex="1" parent="1">
          <mxGeometry x="1380" y="890" width="200" height="380" as="geometry"/>
        </mxCell>
        
        <!-- FastAPI: Enrich Job Data -->
        <mxCell id="f1-enrich" value="Enrich Job Data&#xa;&#xa;enriched_jobs = []&#xa;&#xa;for job in jobs:&#xa;  # Calculate time remaining&#xa;  if job.estimated_completion:&#xa;    time_remaining = &#xa;      job.estimated_completion - now()&#xa;  &#xa;  # Get pg-boss status&#xa;  pg_status = await&#xa;    pgboss.get_job_status(&#xa;      job.id&#xa;    )&#xa;  &#xa;  enriched_jobs.append({&#xa;    **job,&#xa;    'time_remaining': time_remaining,&#xa;    'queue_position': &#xa;      pg_status.position,&#xa;    'can_cancel': &#xa;      job.status in [&#xa;        'queued', 'processing'&#xa;      ]&#xa;  })" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontFamily=Courier New;fontSize=8;align=left;" vertex="1" parent="1">
          <mxGeometry x="560" y="1270" width="260" height="280" as="geometry"/>
        </mxCell>
        
        <!-- pg-boss: Get Job Status -->
        <mxCell id="pg1-status" value="Get Job Status&#xa;&#xa;SELECT &#xa;  state,&#xa;  priority,&#xa;  retrycount,&#xa;  startafter,&#xa;  keepuntil&#xa;FROM pgboss.job&#xa;WHERE id = $1&#xa;&#xa;Returns:&#xa;• state: 'created',&#xa;  'active', 'completed'&#xa;• position in queue" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontFamily=Courier New;fontSize=8;align=left;" vertex="1" parent="1">
          <mxGeometry x="860" y="1310" width="220" height="200" as="geometry"/>
        </mxCell>
        
        <!-- FastAPI: Cache Results -->
        <mxCell id="f1-cache-set" value="Cache Results in Redis&#xa;&#xa;cache_data = {&#xa;  'jobs': enriched_jobs,&#xa;  'total_count': len(jobs),&#xa;  'cached_at': datetime.now()&#xa;}&#xa;&#xa;await redis.setex(&#xa;  f'jobs:{user_id}:active',&#xa;  30,  # TTL in seconds&#xa;  json.dumps(cache_data)&#xa;)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontFamily=Courier New;fontSize=9;align=left;" vertex="1" parent="1">
          <mxGeometry x="560" y="1610" width="260" height="180" as="geometry"/>
        </mxCell>
        
        <!-- Redis: Set Cache -->
        <mxCell id="redis1-set" value="SETEX&#xa;jobs:{user_id}:active&#xa;30&#xa;{json_data}&#xa;&#xa;Returns: OK&#xa;&#xa;Key expires after&#xa;30 seconds" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#C62828;fontFamily=Courier New;fontSize=9;align=left;" vertex="1" parent="1">
          <mxGeometry x="1620" y="1610" width="160" height="140" as="geometry"/>
        </mxCell>
        
        <!-- FastAPI: Return Response -->
        <mxCell id="f1-return" value="Return JSON Response&#xa;&#xa;{&#xa;  'jobs': [&#xa;    {&#xa;      'id': 'uuid',&#xa;      'status': 'processing',&#xa;      'stage': 'Generating content',&#xa;      'progress_percentage': 45,&#xa;      'estimated_completion':&#xa;        '2025-11-03T12:34:56Z',&#xa;      'sub_chapter_title':&#xa;        'Arrival at Mars Colony',&#xa;      'chapter_title':&#xa;        'Chapter 3',&#xa;      'character_name': 'Dr. Chen',&#xa;      'time_remaining_seconds': 67,&#xa;      'queue_position': null,&#xa;      'can_cancel': true,&#xa;      'created_at':&#xa;        '2025-11-03T12:32:00Z'&#xa;    }&#xa;  ],&#xa;  'total_count': 3&#xa;}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontFamily=Courier New;fontSize=8;align=left;" vertex="1" parent="1">
          <mxGeometry x="560" y="1850" width="260" height="340" as="geometry"/>
        </mxCell>
        
        <!-- React: Render Jobs List -->
        <mxCell id="r1-render" value="Render Jobs Dashboard&#xa;&#xa;• Update state:&#xa;  setJobs(response.jobs)&#xa;  setLoading(false)&#xa;&#xa;• Display job cards:&#xa;  {jobs.map(job =&gt; (&#xa;    &lt;JobCard key={job.id}&gt;&#xa;      &lt;h3&gt;{job.sub_chapter_title}&lt;/h3&gt;&#xa;      &lt;StatusBadge status={job.status}/&gt;&#xa;      &lt;ProgressBar &#xa;        value={job.progress_percentage}&#xa;      /&gt;&#xa;      &lt;TimeRemaining &#xa;        seconds={job.time_remaining}&#xa;      /&gt;&#xa;      {job.can_cancel &amp;&amp; (&#xa;        &lt;CancelButton jobId={job.id}/&gt;&#xa;      )}&#xa;    &lt;/JobCard&gt;&#xa;  ))}&#xa;&#xa;• Group by status:&#xa;  - Processing (yellow badge)&#xa;  - Queued (gray badge)&#xa;&#xa;• Show empty state if no jobs:&#xa;  'No active generation jobs'" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontFamily=Courier New;fontSize=8;align=left;" vertex="1" parent="1">
          <mxGeometry x="260" y="1850" width="260" height="440" as="geometry"/>
        </mxCell>
        
        <!-- User: View Dashboard -->
        <mxCell id="u1-view" value="See Active Jobs&#xa;Dashboard&#xa;&#xa;• Job cards&#xa;• Status badges&#xa;• Progress bars&#xa;• Time remaining&#xa;• Cancel buttons" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontFamily=Arial;fontSize=10;align=left;" vertex="1" parent="1">
          <mxGeometry x="60" y="1940" width="160" height="140" as="geometry"/>
        </mxCell>
        
        <!-- PHASE 2: WEBSOCKET CONNECTION -->
        <mxCell id="phase2" value="PHASE 2: WEBSOCKET CONNECTION FOR REAL-TIME UPDATES" style="text;html=1;strokeColor=#F9A825;fillColor=#FFF9C4;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=12;fontStyle=1;fontFamily=Arial;" vertex="1" parent="1">
          <mxGeometry x="40" y="2360" width="1760" height="30" as="geometry"/>
        </mxCell>
        
        <!-- React: Initialize WebSocket -->
        <mxCell id="r1-ws-init" value="Initialize WebSocket Connection&#xa;&#xa;useEffect(() =&gt; {&#xa;  const wsUrl = &#xa;    `ws://localhost:8000/ws/jobs/${userId}`;&#xa;  &#xa;  const ws = new WebSocket(wsUrl);&#xa;  &#xa;  ws.onopen = () =&gt; {&#xa;    console.log('WebSocket connected');&#xa;    setWsConnected(true);&#xa;    setWsError(null);&#xa;  };&#xa;  &#xa;  ws.onmessage = (event) =&gt; {&#xa;    const data = JSON.parse(event.data);&#xa;    handleJobUpdate(data);&#xa;  };&#xa;  &#xa;  ws.onerror = (error) =&gt; {&#xa;    console.error('WebSocket error:', error);&#xa;    setWsError('Connection error');&#xa;  };&#xa;  &#xa;  ws.onclose = () =&gt; {&#xa;    console.log('WebSocket disconnected');&#xa;    setWsConnected(false);&#xa;    // Attempt reconnection&#xa;    attemptReconnect();&#xa;  };&#xa;  &#xa;  return () =&gt; ws.close();&#xa;}, [userId]);" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontFamily=Courier New;fontSize=8;align=left;" vertex="1" parent="1">
          <mxGeometry x="260" y="2420" width="260" height="380" as="geometry"/>
        </mxCell>
        
        <!-- WebSocket: Accept Connection -->
        <mxCell id="ws1-accept" value="Accept WebSocket Connection&#xa;&#xa;@app.websocket('/ws/jobs/{user_id}')&#xa;async def websocket_jobs(&#xa;  websocket: WebSocket,&#xa;  user_id: str&#xa;):&#xa;  # Accept connection&#xa;  await websocket.accept()&#xa;  &#xa;  # Store in active connections&#xa;  if user_id not in &#xa;      active_connections:&#xa;    active_connections[user_id] = []&#xa;  &#xa;  active_connections[user_id]\\&#xa;    .append(websocket)&#xa;  &#xa;  # Send connection confirmation&#xa;  await websocket.send_json({&#xa;    'type': 'connected',&#xa;    'user_id': user_id,&#xa;    'timestamp': &#xa;      datetime.now().isoformat(),&#xa;    'message': &#xa;      'Real-time updates active'&#xa;  })&#xa;  &#xa;  # Keep connection alive&#xa;  try:&#xa;    while True:&#xa;      # Heartbeat every 30s&#xa;      await asyncio.sleep(30)&#xa;      await websocket.send_json({&#xa;        'type': 'heartbeat',&#xa;        'timestamp': &#xa;          datetime.now().isoformat()&#xa;      })&#xa;  except WebSocketDisconnect:&#xa;    # Remove from active connections&#xa;    active_connections[user_id]\\&#xa;      .remove(websocket)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#F9A825;fontFamily=Courier New;fontSize=7;align=left;" vertex="1" parent="1">
          <mxGeometry x="1120" y="2420" width="220" height="560" as="geometry"/>
        </mxCell>
        
        <!-- React: Connection Established -->
        <mxCell id="r1-ws-connected" value="WebSocket Connected&#xa;&#xa;• Show 'Live Updates' indicator:&#xa;  &lt;Badge color='success'&gt;&#xa;    &lt;Circle className='animate-pulse'/&gt;&#xa;    Live Updates&#xa;  &lt;/Badge&gt;&#xa;&#xa;• Update state:&#xa;  setWsConnected(true)&#xa;&#xa;• Stop polling fallback&#xa;  if it was running" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontFamily=Courier New;fontSize=9;align=left;" vertex="1" parent="1">
          <mxGeometry x="260" y="2850" width="260" height="180" as="geometry"/>
        </mxCell>
        
        <!-- User: See Live Indicator -->
        <mxCell id="u1-live" value="See 'Live Updates'&#xa;Indicator&#xa;&#xa;• Green pulsing dot&#xa;• 'Live' badge" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontFamily=Arial;fontSize=10;align=left;" vertex="1" parent="1">
          <mxGeometry x="60" y="2880" width="160" height="100" as="geometry"/>
        </mxCell>
        
        <!-- CONNECTIONS FOR PHASE 1 -->
        <mxCell id="c1" edge="1" parent="1" source="u1-navigate" target="r1-load">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="c2" edge="1" parent="1" source="r1-load" target="r1-api-call">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="c3" edge="1" parent="1" source="r1-api-call" target="f1-receive">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="c4" edge="1" parent="1" source="f1-receive" target="f1-check-cache">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="c5" edge="1" parent="1" source="f1-check-cache" target="redis1-lookup">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="c6" edge="1" parent="1" source="redis1-lookup" target="d1-cache-hit">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1700" y="720"/>
              <mxPoint x="690" y="720"/>
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="c7" edge="1" parent="1" source="d1-cache-hit" target="f1-query-db">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="l7" value="NO&#xa;(Cache Miss)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontFamily=Arial;fontStyle=1;" vertex="1" connectable="0" parent="c7">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="10" as="offset"/>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="c8" edge="1" parent="1" source="d1-cache-hit" target="f1-return">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="840" y="790"/>
              <mxPoint x="840" y="2020"/>
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l8" value="YES&#xa;(Return Cached)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontFamily=Arial;fontStyle=1;fillColor=#C8E6C9;strokeColor=#388E3C;" vertex="1" connectable="0" parent="c8">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="15" y="-10" as="offset"/>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="c9" edge="1" parent="1" source="f1-query-db" target="s1-query">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="c10" edge="1" parent="1" source="s1-query" target="f1-enrich">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1480" y="1280"/>
              <mxPoint x="690" y="1280"/>
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="c11" edge="1" parent="1" source="f1-enrich" target="pg1-status">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="c12" edge="1" parent="1" source="pg1-status" target="f1-enrich">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="970" y="1480"/>
              <mxPoint x="690" y="1480"/>
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="c13" edge="1" parent="1" source="f1-enrich" target="f1-cache-set">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="c14" edge="1" parent="1" source="f1-cache-set" target="redis1-set">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="c15" edge="1" parent="1" source="f1-cache-set" target="f1-return">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="c16" edge="1" parent="1" source="f1-return" target="r1-render">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="c17" edge="1" parent="1" source="r1-render" target="u1-view">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- CONNECTIONS FOR PHASE 2 -->
        <mxCell id="c18" edge="1" parent="1" source="r1-load" target="r1-ws-init">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="220" y="260"/>
              <mxPoint x="220" y="2610"/>
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l18" value="Parallel:&#xa;Init WebSocket" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontFamily=Arial;fontStyle=2;" vertex="1" connectable="0" parent="c18">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="-25" y="500" as="offset"/>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="c19" edge="1" parent="1" source="r1-ws-init" target="ws1-accept">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="c20" edge="1" parent="1" source="ws1-accept" target="r1-ws-connected">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1080" y="2920"/>
              <mxPoint x="540" y="2920"/>
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l20" value="Connection&#xa;Confirmed" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontFamily=Arial;" vertex="1" connectable="0" parent="c20">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint as="offset"/>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="c21" edge="1" parent="1" source="r1-ws-connected" target="u1-live">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
